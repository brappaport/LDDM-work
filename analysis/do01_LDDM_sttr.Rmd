---
title: "Data analysis script 1: Preliminary ERP to DDM concordance"
author: "Brent Rappaport"
date: "`r format(Sys.time(),  '%Y-%m-%d')`"
output:
  pdf_document: default
  html_document:
    df_print: paged
subtitle: Template Rmd
editor_options:
  chunk_output_type: console
toc: yes
---

# About
This script imports and merges the self-report data from the Flanker task of the State-Trait study

# 1. Get Setup
## 1.1. Clear everything & set width
```{r echo=FALSE, results='hide', message=FALSE, warning=FALSE}
    options(width=80, Ncpus = 6) #Set width
    rm(list=ls())     #Remove everything from environment
    cat("\014")       #Clear Console
```

## 1.2. Load Libraries
```{r echo=TRUE, results='hide', message=FALSE}
  # renv::restore()     #restore environment
  library(knitr)      #allows rmarkdown files
  # library(haven)      #helps import stata
  library(questionr)  #allows lookfor function
  library(MASS)       #calculate residualized scores
  library(tidyverse)  #plotting/cleaning, etc.
  library(broom)      #nice statistical output
  library(here)       #nice file paths
  library(expss)      #labeling variables/values
  library(psych)      #used for statistical analyses
  library(papaja)
  library(workflowr)  #helps with workflow
  library(ggplot2)
```

## 1.3. Get the Working Directory
```{r}
  here()
```

## 1.4. Set seed
```{r}
     set.seed(312)    #Set seed
```

## 1.5 Load Data
Remember to immediately rename and remove. Avoid overwriting old data.
```{r}
# FULL DATA--ALL DAYS
## Load full multi-day dataset
load(file=here("./data/LDDM_cleaning03.RData"))
LDDM_do1 <- LDDM_cleaning03; rm(LDDM_cleaning03)
## Load raw data across all days
load(file=here("./data/LDDM_cleaning02_rt.RData"))
LDDM_do1_rt <- LDDM_cleaning02_rt; rm(LDDM_cleaning02_rt)

# DAY 1
## Load Day 1 dataset
load(file=here("./data/LDDM_cleaning03_d1.RData"))
LDDM_do1_d1 <- LDDM_cleaning03_d1; rm(LDDM_cleaning03_d1)
# Load NIH Toolbox flanker score Day 1 dataset
load(file=here("./data/LDDM_cleaning04_d1_calc3.RData"))
# Merge Day 1 dataset with NIH Toolbox flanker score Day 1 dataset
LDDM_do2_d1 <- left_join(LDDM_do1_d1, LDDM_cleaning04_d1_calc3, by="ID")
# Load Day 1 Alternative model results
LDDM_do_alt_d1 <- read.csv(here("../DDM_Results/Block_Based_Day1/Day1_Block11_Alternative_Models.csv"), header=TRUE)
LDDM_do2_alt_d1<- left_join(select(LDDM_do1_d1, contains("ID") | contains("ERN") | contains ("P3")), LDDM_do_alt_d1, by="ID")


# DAY 2
## Load Day 2 dataset
load(file=here("./data/LDDM_cleaning03_d2.RData"))
LDDM_do1_d2 <- LDDM_cleaning03_d2; rm(LDDM_cleaning03_d2)
# Load NIH Toolbox flanker score Day 2 dataset
load(file=here("./data/LDDM_cleaning04_d2_calc3.RData"))
# Merge Day 2 dataset with NIH Toolbox flanker score Day 2 dataset
LDDM_do2_d2 <- left_join(LDDM_do1_d2, LDDM_cleaning04_d2_calc3, by="ID")

# DAY 3
## Load Day 3 dataset
load(file=here("./data/LDDM_cleaning03_d3.RData"))
LDDM_do1_d3 <- LDDM_cleaning03_d3; rm(LDDM_cleaning03_d3)
# Load NIH Toolbox flanker score Day 3 dataset
load(file=here("./data/LDDM_cleaning04_d3_calc3.RData"))
# Merge Day 3 dataset with NIH Toolbox flanker score Day 3 dataset
LDDM_do2_d3 <- left_join(LDDM_do1_d3, LDDM_cleaning04_d3_calc3, by="ID")
```

# SET OUTLIER THRESHOLD HERE
```{r}
LDDM_do2_d1_no_outliers <- filter(LDDM_do2_d1, FCZ_ERN_080>-3 & FCZ_ERN_080<3)
LDDM_do2_d2_no_outliers <- filter(LDDM_do2_d2, FCZ_ERN_080>-3 & FCZ_ERN_080<3)
LDDM_do2_d3_no_outliers <- filter(LDDM_do2_d3, FCZ_ERN_080>-3 & FCZ_ERN_080<3)
```

## 1.8 Standardize scores
```{r}
LDDM_do2_d1$v_S1_B11 <- rowMeans(LDDM_do2_d1[,c('v_congruent_S1_B11','v_incongruent_S1_B11')], na.rm=F)
LDDM_do2_d2$v_S2_B11 <- rowMeans(LDDM_do2_d2[,c('v_congruent_S2_B11','v_incongruent_S2_B11')], na.rm=F)
LDDM_do2_d3$v_S3_B11 <- rowMeans(LDDM_do2_d3[,c('v_congruent_S3_B11','v_incongruent_S3_B11')], na.rm=F)

var_list_d1 <- c("v_S1_B11","v_congruent_S1_B11","v_incongruent_S1_B11","a_S1_B11","t_S1_B11","z_S1_B11",
              "flanker_score_d1",
              "FCZ_ERN_080","PZ_P3_onset_con","PZ_P3_onset_incon")

var_list_d2 <- c("v_S2_B11","v_congruent_S2_B11","v_incongruent_S2_B11","a_S2_B11","t_S2_B11","z_S2_B11",
              "flanker_score_d2",
              "FCZ_ERN_080","PZ_P3_onset_con","PZ_P3_onset_incon")

var_list_d3 <- c("v_S3_B11","v_congruent_S3_B11","v_incongruent_S3_B11","a_S3_B11","t_S3_B11","z_S3_B11",
              "flanker_score_d3",
              "FCZ_ERN_080","PZ_P3_onset_con","PZ_P3_onset_incon")

var_list_alt <- c("B11_avt_v","B11_avt_a","B11_avt_t",
              "B11_avtz_v","B11_avtz_a","B11_avtz_t","B11_avtz_z",
              "B11_avtz_DO_vt_v_con","B11_avtz_DO_vt_v_incon","B11_avtz_DO_vt_a", "B11_avtz_DO_vt_t_con","B11_avtz_DO_vt_t_incon","B11_avtz_DO_vt_z",
              "B11_avtz_DO_vtz_v_con","B11_avtz_DO_vtz_v_incon","B11_avtz_DO_vtz_a","B11_avtz_DO_vtz_t_con","B11_avtz_DO_vtz_t_incon","B11_avtz_DO_vtz_z_con","B11_avtz_DO_vtz_z_incon",
              "FCZ_ERN_080","PZ_P3_onset_con","PZ_P3_onset_incon")

for (v in var_list_d1){ 
  print(paste0("LDDM_do2_d1$",v))
  eval(parse(text=paste0('LDDM_do2_d1$',v,'_z <- scale(LDDM_do2_d1$',v,', center=T, scale=T)'))) 
}

for (v in var_list_alt){ 
  print(paste0("LDDM_do2_alt_d1$",v))
  eval(parse(text=paste0('LDDM_do2_alt_d1$',v,'_z <- scale(LDDM_do2_alt_d1$',v,', center=T, scale=T)'))) 
}

for (v in var_list_d2){ 
  print(paste0("LDDM_do2_d2$",v))
  eval(parse(text=paste0('LDDM_do2_d2$',v,'_z <- scale(LDDM_do2_d2$',v,', center=T, scale=T)'))) 
}

for (v in var_list_d3){ 
  print(paste0("LDDM_do2_d3$",v))
  eval(parse(text=paste0('LDDM_do2_d3$',v,'_z <- scale(LDDM_do2_d3$',v,', center=T, scale=T)'))) 
}
```


# 2. Correlation between ERP measures and DDM parameters
Bias = z
Drift rate = v
Decision boundary separation = a
Non-decision time = t

Per Allie, larger values of v mean faster accumulation of evidence (faster rate), larger t means slower non-decision time processing, larger a means more separation between the correct and incorrect response boundaries, and z is the distance from the upper boundary to the start of the drift process.

## 2.1 ERN mean amplitude
### 2.1.1 Day 1
```{r}
ERN_table_d1 <- data.frame(parameters= c("v", "v_congruent", "v_incongruent", "a", "t", "z"),
                        r= c(corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$v_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$v_congruent_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$v_incongruent_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$a_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$t_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$z_S1_B11_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$v_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$v_congruent_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$v_incongruent_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$a_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$t_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$FCZ_ERN_080_z, LDDM_do2_d1$z_S1_B11_z)$p)); ERN_table_d1$p_corrected <- p.adjust(ERN_table_d1$p_nominal, method="fdr"); ERN_table_d1[,2:4] <- round(ERN_table_d1[,2:4], 3)
ERN_table_d1

write.csv(ERN_table_d1, here("./tables/sttr_ERN_table_d1.csv"))

ggplot(LDDM_do2_d1, aes(x=FCZ_ERN_080_z, y=v_S1_B11)) +
  geom_point() +
  stat_smooth(method="lm")
```
I *think* this is saying that the larger the ERN amplitude (since a more negative ERN is a larger amplitude), the faster the drift rate/accumulation of evidence (v). This is true for congruent and incongruent stimuli, and at FCz, Fz, and Cz.

#### 2.1.1.1 Alternative models
##### ERN
```{r}
ERN_table_d1_alt1 <- data.frame(parameters= c("v", "a", "t"),
                        r= c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avt_v_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avt_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avt_t_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avt_v_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avt_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avt_t_z)$p)); ERN_table_d1_alt1$p_corrected <- p.adjust(ERN_table_d1_alt1$p_nominal, method="fdr"); ERN_table_d1_alt1[,2:4] <- round(ERN_table_d1_alt1[,2:4], 3)

ERN_table_d1_alt2 <- data.frame(parameters= c("v", "a", "t", "z"),
                        r= c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_v_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_t_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_z_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_v_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_t_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_z_z)$p)); ERN_table_d1_alt2$p_corrected <- p.adjust(ERN_table_d1_alt2$p_nominal, method="fdr"); ERN_table_d1_alt2[,2:4] <- round(ERN_table_d1_alt2[,2:4], 3)

ERN_table_d1_alt3 <- data.frame(parameters= c("v_congruent", "v_incongruent", "a", "t_congruent","t_incongruent", "z"),
                        r= c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_z_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_z_z)$p)); ERN_table_d1_alt3$p_corrected <- p.adjust(ERN_table_d1_alt3$p_nominal, method="fdr"); ERN_table_d1_alt3[,2:4] <- round(ERN_table_d1_alt3[,2:4], 3)

ERN_table_d1_alt4 <- data.frame(parameters= c("v_congruent", "v_incongruent", "a", "t_congruent","t_incongruent", "z_congruent", "z_incongruent"),
                        r= c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_incon_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$FCZ_ERN_080_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_incon_z)$p)); ERN_table_d1_alt4$p_corrected <- p.adjust(ERN_table_d1_alt4$p_nominal, method="fdr"); ERN_table_d1_alt4[,2:4] <- round(ERN_table_d1_alt4[,2:4], 3)

write.csv(t(ERN_table_d1_alt1), here("./tables/ERN_table_d1_alt1.csv"))
write.csv(t(ERN_table_d1_alt2), here("./tables/ERN_table_d1_alt2.csv"))
write.csv(t(ERN_table_d1_alt3), here("./tables/ERN_table_d1_alt3.csv"))
write.csv(t(ERN_table_d1_alt4), here("./tables/ERN_table_d1_alt4.csv"))
```

##### P3
```{r}
P3_table_d1_alt1 <- data.frame(parameters= c("v", "a", "t"),
                        r= c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avt_v_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avt_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avt_t_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avt_v_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avt_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avt_t_z)$p)); P3_table_d1_alt1$p_corrected <- p.adjust(P3_table_d1_alt1$p_nominal, method="fdr"); P3_table_d1_alt1[,2:4] <- round(P3_table_d1_alt1[,2:4], 3)

P3_table_d1_alt2 <- data.frame(parameters= c("v", "a", "t", "z"),
                        r= c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_v_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_t_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_z_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_v_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_t_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_z_z)$p)); P3_table_d1_alt2$p_corrected <- p.adjust(P3_table_d1_alt2$p_nominal, method="fdr"); P3_table_d1_alt2[,2:4] <- round(P3_table_d1_alt2[,2:4], 3)

P3_table_d1_alt3 <- data.frame(parameters= c("v_congruent", "v_incongruent", "a", "t_congruent","t_incongruent", "z"),
                        r= c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_z_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_v_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_t_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vt_z_z)$p)); P3_table_d1_alt3$p_corrected <- p.adjust(P3_table_d1_alt3$p_nominal, method="fdr"); P3_table_d1_alt3[,2:4] <- round(P3_table_d1_alt3[,2:4], 3)

P3_table_d1_alt4 <- data.frame(parameters= c("v_congruent", "v_incongruent", "a", "t_congruent","t_incongruent", "z_congruent", "z_incongruent"),
                        r= c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_a_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_incon_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_con_z)$r,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_incon_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_v_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_a_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_t_incon_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_con_z)$p,
                             corr.test(LDDM_do2_alt_d1$PZ_P3_onset_incon_z, LDDM_do2_alt_d1$B11_avtz_DO_vtz_z_incon_z)$p)); P3_table_d1_alt4$p_corrected <- p.adjust(P3_table_d1_alt4$p_nominal, method="fdr"); P3_table_d1_alt4[,2:4] <- round(P3_table_d1_alt4[,2:4], 3)

write.csv(t(P3_table_d1_alt1), here("./tables/P3_table_d1_alt1.csv"))
write.csv(t(P3_table_d1_alt2), here("./tables/P3_table_d1_alt2.csv"))
write.csv(t(P3_table_d1_alt3), here("./tables/P3_table_d1_alt3.csv"))
write.csv(t(P3_table_d1_alt4), here("./tables/P3_table_d1_alt4.csv"))
```

### 2.1.2 Day 2
```{r}
# LDDM_do2_d2 <- LDDM_do2_d2 %>%
  # filter(v_incongruent_S2_B11>0 & v_congruent_S2_B11>2)

ERN_table_d2 <- data.frame(parameters= c("v", "v_congruent", "v_incongruent", "a", "t", "z"),
                        r= c(corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$v_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$v_congruent_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$v_incongruent_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$a_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$t_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$z_S2_B11_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$v_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$v_congruent_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$v_incongruent_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$a_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$t_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$FCZ_ERN_080_z, LDDM_do2_d2$z_S2_B11_z)$p)); ERN_table_d2$p_corrected <- p.adjust(ERN_table_d2$p_nominal, method="fdr"); ERN_table_d2[,2:4] <- round(ERN_table_d2[,2:4], 3)
ERN_table_d2

write.csv(ERN_table_d2, here("./tables/sttr_ERN_table_d2.csv"))

ggplot(LDDM_do2_d2, aes(x=FCZ_ERN_080_z, y=v_congruent_S2_B11)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(LDDM_do2_d2, aes(x=FCZ_ERN_080_z, y=v_S2_B11)) +
  geom_point() +
  stat_smooth(method="lm")
```
Nominal replication of Day 1: ERN nominally significantly related to v (congruent) and average v, but not when FDR-corrected.

### 2.1.3 Day 3
```{r}
ERN_table_d3 <- data.frame(parameters= c("v", "v_congruent", "v_incongruent", "a", "t", "z"),
                        r= c(corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$v_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$v_congruent_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$v_incongruent_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$a_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$t_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$z_S3_B11_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$v_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$v_congruent_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$v_incongruent_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$a_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$t_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$FCZ_ERN_080_z, LDDM_do2_d3$z_S3_B11_z)$p)); ERN_table_d3$p_corrected <- p.adjust(ERN_table_d3$p_nominal, method="fdr"); ERN_table_d3[,2:4] <- round(ERN_table_d3[,2:4], 3)
ERN_table_d3

write.csv(ERN_table_d3, here("./tables/sttr_ERN_table_d3.csv"))

ggplot(LDDM_do2_d3, aes(x=FCZ_ERN_080_z, y=v_congruent_S3_B11)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(LDDM_do2_d3, aes(x=FCZ_ERN_080_z, y=v_S3_B11)) +
  geom_point() +
  stat_smooth(method="lm")
```

## 2.2 P3 onset
### 2.2.1 Day 1
```{r}
P3_table_d1 <- data.frame(parameters= c(rep(c("v", "v_congruent", "v_incongruent", "a", "t", "z"),1)),
                        r= c(corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$v_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_con_z, LDDM_do2_d1$v_congruent_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$v_incongruent_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$a_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$t_S1_B11_z)$r,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$z_S1_B11_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$v_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_con_z, LDDM_do2_d1$v_congruent_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$v_incongruent_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$a_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$t_S1_B11_z)$p,
                             corr.test(LDDM_do2_d1$PZ_P3_onset_incon_z, LDDM_do2_d1$z_S1_B11_z)$p)); P3_table_d1$p_corrected <- p.adjust(P3_table_d1$p_nominal, method="fdr"); P3_table_d1[,2:4] <- round(P3_table_d1[,2:4], 3)
P3_table_d1

write.csv(P3_table_d1, here("./tables/sttr_P3_table_d1.csv"))

ggplot(LDDM_do2_d1, aes(x=PZ_P3_onset_incon_z, y=v_congruent_S1_B11)) +
  geom_point() +
  stat_smooth(method="lm")
```
P3 nominally significantly related to v (congruent) and the average v, but not when FDR-corrected.

### 2.2.2 Day 2
```{r}
P3_table_d2 <- data.frame(parameters= c(rep(c("v", "v_congruent", "v_incongruent", "a", "t", "z"),1)),
                        r= c(corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$v_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_con_z, LDDM_do2_d2$v_congruent_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$v_incongruent_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$a_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$t_S2_B11_z)$r,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$z_S2_B11_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$v_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_con_z, LDDM_do2_d2$v_congruent_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$v_incongruent_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$a_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$t_S2_B11_z)$p,
                             corr.test(LDDM_do2_d2$PZ_P3_onset_incon_z, LDDM_do2_d2$z_S2_B11_z)$p)); P3_table_d2$p_corrected <- p.adjust(P3_table_d2$p_nominal, method="fdr"); P3_table_d2[,2:4] <- round(P3_table_d2[,2:4], 3)
P3_table_d2

write.csv(P3_table_d2, here("./tables/sttr_P3_table_d2.csv"))

ggplot(LDDM_do2_d2, aes(x=PZ_P3_onset_incon_z, y=v_congruent_S2_B11)) +
  geom_point() +
  stat_smooth(method="lm")
```
P3 nominally significantly related to t and trend-level nominally related to v (congruent), but not when FDR-corrected.

### 2.2.3 Day 3
```{r}
P3_table_d3 <- data.frame(parameters= c(rep(c("v", "v_congruent", "v_incongruent", "a", "t", "z"),1)),
                        r= c(corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$v_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_con_z, LDDM_do2_d3$v_congruent_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$v_incongruent_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$a_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$t_S3_B11_z)$r,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$z_S3_B11_z)$r),
                        p_nominal = c(corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$v_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_con_z, LDDM_do2_d3$v_congruent_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$v_incongruent_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$a_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$t_S3_B11_z)$p,
                             corr.test(LDDM_do2_d3$PZ_P3_onset_incon_z, LDDM_do2_d3$z_S3_B11_z)$p)); P3_table_d3$p_corrected <- p.adjust(P3_table_d3$p_nominal, method="fdr"); P3_table_d3[,2:4] <- round(P3_table_d3[,2:4], 3)
P3_table_d3

write.csv(P3_table_d3, here("./tables/sttr_P3_table_d3.csv"))

ggplot(LDDM_do2_d3, aes(x=PZ_P3_onset_incon_z, y=v_S3_B11)) +
  geom_point() +
  stat_smooth(method="lm")
```

```{r}
library(corrplot)
all_measures_d1 <- c("FCZ_ERN_080","FCZ_ERN_0100","Congruent_PZ_fpl","Incongruent_PZ_fpl",
                  "z_S1_B11","v_congruent_S1_B11","v_incongruent_S1_B11","v_S1_B11","a_S1_B11","t_S1_B11")
all_measures_d2 <- c("FCZ_ERN_080","FCZ_ERN_0100","Congruent_PZ_fpl","Incongruent_PZ_fpl",
                  "z_S2_B11","v_congruent_S2_B11","v_incongruent_S2_B11","v_S2_B11","a_S2_B11","t_S2_B11")
all_measures_d3 <- c("FCZ_ERN_080","FCZ_ERN_0100","Congruent_PZ_fpl","Incongruent_PZ_fpl",
                  "z_S3_B11","v_congruent_S3_B11","v_incongruent_S3_B11","v_S3_B11","a_S3_B11","t_S3_B11")
corrplot(cor(LDDM_do2_d1[c(all_measures_d1)],use="pairwise.complete.obs"), method="circle")
corrplot(cor(LDDM_do2_d2[c(all_measures_d2)],use="pairwise.complete.obs"), method="circle")
corrplot(cor(LDDM_do2_d3[c(all_measures_d3)],use="pairwise.complete.obs"), method="circle")
```


# 3.  Compared to typical Flanker metrics
### Day 1
```{r}
# ERN
mr_ERN_table_d1 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2]),
                      p_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2]),
                      b_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3]),
                      p_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3]))
write.csv(mr_ERN_table_d1, here("./tables/mr_ERN_table_d1.csv"))

corr.test(LDDM_do2_d1$flanker_score_d1_z, LDDM_do2_d1$FCZ_ERN_080_z, use="complete.obs", method="pearson")

ggplot(filter(LDDM_do2_d1), aes(x=FCZ_ERN_080_z, y=flanker_score_d1)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(filter(LDDM_do2_d1, flanker_score_d1>4), aes(x=FCZ_ERN_080_z, y=flanker_score_d1)) +
  geom_point() +
  stat_smooth(method="lm")

# P3
mr_P3_table_d1 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2]),
                      p_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2]),
                      b_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3]),
                      p_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3]))
write.csv(mr_P3_table_d1, here("./tables/mr_P3_table_d1.csv"))

corr.test(LDDM_do2_d1$flanker_score_d1, LDDM_do2_d1$PZ_P3_onset_incon_z, use="complete.obs", method="pearson")
```
DDM parameters largely do not explain significant variance over-and-above average RT and accuracy (0.125*correct responses), though this is likely due to considerable covariation between DDM parameters and RT/accuracy. They also do not explain variance over-and-above a typical "flanker score" that incorporates accuracy and RT info in a summed score.

### Day 2
```{r}
# ERN
mr_ERN_table_d2 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2]),
                      p_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2]),
                      b_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3]),
                      p_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3]))
write.csv(mr_ERN_table_d2, here("./tables/mr_ERN_table_d2.csv"))

corr.test(LDDM_do2_d2$flanker_score_d2_z, LDDM_do2_d2$FCZ_ERN_080_z, use="complete.obs", method="pearson")

ggplot(filter(LDDM_do2_d2), aes(x=FCZ_ERN_080_z, y=flanker_score_d2)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(filter(LDDM_do2_d2, flanker_score_d2>4), aes(x=FCZ_ERN_080_z, y=flanker_score_d2)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(filter(LDDM_do2_d2, flanker_score_d2>4), aes(x=FCZ_ERN_080_z, y=v_S2_B11)) +
  geom_point() +
  stat_smooth(method="lm")


# P3
mr_P3_table_d2 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[2]),
                      p_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[2]),
                      b_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$estimate[3]),
                      p_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S2_B11_z + flanker_score_d2_z, LDDM_do2_d2))$p.value[3]))
write.csv(mr_P3_table_d2, here("./tables/mr_P3_table_d2.csv"))

corr.test(LDDM_do2_d2$flanker_score_d2, LDDM_do2_d2$PZ_P3_onset_incon_z, use="complete.obs", method="pearson")
```
DDM parameters no longer explain variance in ERN better than typical flanker score. Of note the two are strongly correlated at r=`r round(corr.test(LDDM_do2_d2$flanker_score_d2, LDDM_do2_d2$v_S2_B11, use="complete.obs", method="pearson"_z)$r,3)`.

However, the alpha parameter (boundary separation) explains variances better than the flanker score on P3 congruent and incongruent onset. 


### Day 3
```{r}
# ERN
mr_ERN_table_d3 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2]),
                      p_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2]),
                      b_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3]),
                      p_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3]))
write.csv(mr_ERN_table_d3, here("./tables/mr_ERN_table_d3.csv"))

corr.test(LDDM_do2_d3$flanker_score_d3_z, LDDM_do2_d3$FCZ_ERN_080_z, use="complete.obs", method="pearson")

ggplot(filter(LDDM_do2_d3), aes(x=FCZ_ERN_080_z, y=flanker_score_d3)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(filter(LDDM_do2_d3, flanker_score_d3>4), aes(x=FCZ_ERN_080_z, y=flanker_score_d3)) +
  geom_point() +
  stat_smooth(method="lm")

ggplot(filter(LDDM_do2_d3, flanker_score_d3>4), aes(x=FCZ_ERN_080_z, y=v_S3_B11)) +
  geom_point() +
  stat_smooth(method="lm")


# P3
mr_P3_table_d3 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[2]),
                      p_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[2]),
                      b_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$estimate[3]),
                      p_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S3_B11_z + flanker_score_d3_z, LDDM_do2_d3))$p.value[3]))
write.csv(mr_P3_table_d3, here("./tables/mr_P3_table_d3.csv"))

corr.test(LDDM_do2_d3$flanker_score_d3, LDDM_do2_d3$PZ_P3_onset_incon_z, use="complete.obs", method="pearson")
```

# 4. Reliability
## 4.1 DDM paramters
```{r}
# LDDM_do2_d1$v_S1_B8 <- rowMeans(LDDM_do2_d1[,c('v_congruent_S1_B8','v_incongruent_S1_B8')], na.rm=F)
# LDDM_do2_d2$v_S2_B8 <- rowMeans(LDDM_do2_d2[,c('v_congruent_S2_B8','v_incongruent_S2_B8')], na.rm=F)

LDDM_do2_irr <- left_join(LDDM_do2_d1, LDDM_do2_d2, by="ID") %>%
  left_join(LDDM_do2_d3, by="ID")
library("irr")

sttr_icc_table_12 <- data.frame(parameters= c("v", "v_congruent", "v_incongruent", "a", "t", "z", "nihtoolbox_flanker"),
                           ICC=c(icc(LDDM_do2_irr[c("v_S1_B11","v_S2_B11")])$value,
                           icc(LDDM_do2_irr[c("v_congruent_S1_B11.x","v_congruent_S2_B11.x")])$value,
                           icc(LDDM_do2_irr[c("v_incongruent_S1_B11.x","v_incongruent_S2_B11.x")])$value,
                           icc(LDDM_do2_irr[c("a_S1_B11.x","a_S2_B11.x")])$value,
                           icc(LDDM_do2_irr[c("t_S1_B11.x","t_S2_B11.x")])$value,
                           icc(LDDM_do2_irr[c("z_S1_B11.x","z_S2_B11.x")])$value,
                           icc(LDDM_do2_irr[c("flanker_score_d1","flanker_score_d2")])$value))

sttr_icc_table_23 <- data.frame(parameters= c("v", "v_congruent", "v_incongruent", "a", "t", "z", "nihtoolbox_flanker"),
                           ICC=c(icc(LDDM_do2_irr[c("v_S1_B11","v_S2_B11","v_S3_B11")])$value,
                           icc(LDDM_do2_irr[c("v_congruent_S2_B11.x","v_congruent_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("v_incongruent_S2_B11.x","v_incongruent_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("a_S2_B11.x","a_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("t_S2_B11.x","t_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("z_S2_B11.x","z_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("flanker_score_d2","flanker_score_d3")])$value))

sttr_icc_table_123 <- data.frame(parameters= c("v", "v_congruent", "v_incongruent", "a", "t", "z", "nihtoolbox_flanker"),
                           ICC=c(icc(LDDM_do2_irr[c("v_S1_B11","v_S2_B11","v_S3_B11")])$value,
                           icc(LDDM_do2_irr[c("v_congruent_S1_B11.x","v_congruent_S2_B11.x","v_congruent_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("v_incongruent_S1_B11.x","v_incongruent_S2_B11.x","v_incongruent_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("a_S1_B11.x","a_S2_B11.x","a_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("t_S1_B11.x","t_S2_B11.x","t_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("z_S1_B11.x","z_S2_B11.x","z_S3_B11.x")])$value,
                           icc(LDDM_do2_irr[c("flanker_score_d1","flanker_score_d2","flanker_score_d3")])$value))

write.csv(sttr_icc_table_12, "./tables/sttr_icc_table_12.csv")
write.csv(sttr_icc_table_23, "./tables/sttr_icc_table_23.csv")
write.csv(sttr_icc_table_123, "./tables/sttr_icc_table_123.csv")
```

## 4.2 Typical Flanker metrics
### 4.2.1 ICC
```{r}
LDDM_cleaning04_calc3_1to2 <- left_join(LDDM_cleaning04_d1_calc3, LDDM_cleaning04_d2_calc3, by="ID")
LDDM_cleaning04_calc3_2to3 <- left_join(LDDM_cleaning04_d2_calc3, LDDM_cleaning04_d3_calc3, by="ID")
LDDM_cleaning04_calc3_1to3 <- LDDM_cleaning04_d1_calc3 %>%
  left_join(LDDM_cleaning04_d2_calc3, by="ID") %>%
  left_join(LDDM_cleaning04_d3_calc3, by="ID")

# Days 1 to 2
icc(LDDM_cleaning04_calc3_1to2[c("flanker_score_d1","flanker_score_d2")])
icc(LDDM_cleaning04_calc3_1to2[c("flanker_score_d1_truncated","flanker_score_d2_truncated")])

# Days 2 to 3
icc(LDDM_cleaning04_calc3_2to3[c("flanker_score_d2","flanker_score_d3")])
icc(LDDM_cleaning04_calc3_2to3[c("flanker_score_d2_truncated","flanker_score_d3_truncated")])

# All three days
icc(LDDM_cleaning04_calc3_1to3[c("flanker_score_d1","flanker_score_d2","flanker_score_d3")])
icc(LDDM_cleaning04_calc3_1to3[c("flanker_score_d1_truncated","flanker_score_d2_truncated","flanker_score_d3_truncated")])
```

### 4.2.2 Split half reliability (Spearman-Brown prophecy)
#### Day 1
```{r}
load(file=here("./data/LDDM_cleaning04_fullbeh_d1.RData"))
library(confintr)

LDDM_cleaning04_d1_reliability <- LDDM_cleaning04_fullbeh_d1 %>%
  group_by(subj_idx) %>%
  mutate(block = c(rep(1,30),rep(2,30),rep(3,30),rep(4,30),rep(5,30),rep(6,30),rep(7,30),rep(8,30),rep(9,30),rep(10,30),rep(11,30))) %>%
  group_by(subj_idx) %>%
  mutate(trial = 1:330)

for (s in seq(15,166,15)){
    eval(parse(text=paste0('
LDDM_first',s,'_1 <- LDDM_cleaning04_d1_reliability %>% filter(trial<=',s,')
LDDM_second',s,'_1 <- LDDM_cleaning04_d1_reliability %>% filter(trial< ',(s*2)+1,' & trial>',s,')
  
LDDM_first',s,'_2 <- LDDM_first',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  summarise(accuracy_score = sum(response==1)*(5/length(trial))) # accuracy score per NIH TOoolbox manual
LDDM_second',s,'_2 <- LDDM_second',s,'_1 %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial))) # accuracy score per NIH TOoolbox manual

LDDM_first',s,'_3 <-  LDDM_first',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  filter(stim=="incongruent" & response==1) %>% # incongruent trials with correct response
  mutate(mean_rt = mean(rt),
         sd_rt = sd(rt)) %>% # compute individual mean and sd RT for use below
  filter(rt>=0.1 & rt>(mean_rt - 3*sd_rt) & rt<(mean_rt + 3*sd_rt)) %>% # remove trials less than 100ms and less than 3SD below or 3SD above the mean RT
  summarise(med_rt = median(rt)*1000) %>% # compute individual level median RT
  mutate(rt_score = 5-(5*((log(med_rt)-log(250))/(log(1000)-log(250))))) # compute RT score to go into flanker score
LDDM_second',s,'_3 <-  LDDM_second',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  filter(stim=="incongruent" & response==1) %>% # incongruent trials with correct response
  mutate(mean_rt = mean(rt),
         sd_rt = sd(rt)) %>% # compute individual mean and sd RT for use below
  filter(rt>=0.1 & rt>(mean_rt - 3*sd_rt) & rt<(mean_rt + 3*sd_rt)) %>% # remove trials less than 100ms and less than 3SD below or 3SD above the mean RT
  summarise(med_rt = median(rt)*1000) %>% # compute individual level median RT
  mutate(rt_score = 5-(5*((log(med_rt)-log(250))/(log(1000)-log(250))))) # compute RT score to go into flanker score

LDDM_first',s,' <- LDDM_first',s,'_1 %>%
  full_join(LDDM_first',s,'_2, by = "subj_idx") %>%
  full_join(LDDM_first',s,'_3, by="subj_idx") %>%
  group_by(subj_idx) %>% # per subject
  mutate(total_accuracy_perc = sum(response==1)/length(response)) %>% # compute total accuracy percentage
  summarise(flanker_score_list_d1 = if_else(total_accuracy_perc>=0.8, accuracy_score+rt_score, accuracy_score),
            accuracy = mean(total_accuracy_perc)) %>% # if accuracy is above 80% then add accuracy and rt flanker scores, if not base the flanker score only on accuracy; also compute a regular percentage based accuracy (ie percent of trials when subject was correct)
  transmute(ID=subj_idx, flanker_score_list_d1=flanker_score_list_d1, accuracy=accuracy) %>%
  group_by(ID) %>% # per subject
  summarise(flanker_score_d1 = mean(flanker_score_list_d1),
            accuracy = mean(accuracy))
LDDM_second',s,' <- LDDM_second',s,'_1 %>%
  full_join(LDDM_second',s,'_2, by = "subj_idx") %>%
  full_join(LDDM_second',s,'_3, by="subj_idx") %>%
  group_by(subj_idx) %>% # per subject
  mutate(total_accuracy_perc = sum(response==1)/length(response)) %>% # compute total accuracy percentage
  summarise(flanker_score_list_d1 = if_else(total_accuracy_perc>=0.8, accuracy_score+rt_score, accuracy_score),
            accuracy = mean(total_accuracy_perc)) %>% # if accuracy is above 80% then add accuracy and rt flanker scores, if not base the flanker score only on accuracy; also compute a regular percentage based accuracy (ie percent of trials when subject was correct)
  transmute(ID=subj_idx, flanker_score_list_d1=flanker_score_list_d1, accuracy=accuracy) %>%
  group_by(ID) %>% # per subject
  summarise(flanker_score_d1 = mean(flanker_score_list_d1),
            accuracy = mean(accuracy))
            
r_half_',s,' <- cor(LDDM_first',s,'$flanker_score_d1, LDDM_second',s,'$flanker_score_d1, use="pairwise")
r_half_ci_',s,' <- ci_cor(LDDM_first',s,'$flanker_score_d1, LDDM_second',s,'$flanker_score_d1, use="pairwise")
r_sb_ci_lower_',s,' <- (2*r_half_ci_',s,'$interval[1])/(1+r_half_ci_',s,'$interval[1])
r_sb_ci_upper_',s,' <- (2*r_half_ci_',s,'$interval[2])/(1+r_half_ci_',s,'$interval[2])
r_sb_',s,' <- (2*r_half_',s,')/(1+r_half_',s,')
')))
}

spearman_brown_d1 <- data.frame(trials=seq(15,165,15),
                             r=rep(NA,length(seq(15,165,15))),
                             r_ci_lower=rep(NA,length(seq(15,165,15))),
                             r_ci_upper=rep(NA,length(seq(15,165,15))))
i=1
for (s in seq(15,165,15)){
  eval(parse(text=paste0('spearman_brown_d1[i,2] <- round(as.numeric(r_sb_',s,'),3)
                         spearman_brown_d1[i,3] <- round(as.numeric(r_sb_ci_lower_',s,'),3)
                         spearman_brown_d1[i,4] <- round(as.numeric(r_sb_ci_upper_',s,'),3)')))
  i=i+1
}
spearman_brown_d1

ggplot(spearman_brown_d1, aes(x=trials, y=r, group=1)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(limits = c(0, 1)) +
  geom_ribbon(aes(ymin = r_ci_lower, ymax = r_ci_upper), alpha = 0.2)
```

#### Day 2
```{r}
load(file=here("./data/LDDM_cleaning04_fullbeh_d2.RData"))

LDDM_cleaning04_d2_reliability <- LDDM_cleaning04_fullbeh_d2 %>%
  group_by(subj_idx) %>%
  mutate(block = c(rep(1,30),rep(2,30),rep(3,30),rep(4,30),rep(5,30),rep(6,30),rep(7,30),rep(8,30),rep(9,30),rep(10,30),rep(11,30))) %>%
  group_by(subj_idx) %>%
  mutate(trial = 1:330)

for (s in seq(15,166,15)){
    eval(parse(text=paste0('
LDDM_first',s,'_1 <- LDDM_cleaning04_d2_reliability %>% filter(trial<=',s,')
LDDM_second',s,'_1 <- LDDM_cleaning04_d2_reliability %>% filter(trial< ',(s*2)+1,' & trial>',s,')
  
LDDM_first',s,'_2 <- LDDM_first',s,'_1 %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))
LDDM_second',s,'_2 <- LDDM_second',s,'_1 %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))

LDDM_first',s,'_3 <-  LDDM_first',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  filter(stim=="incongruent" & response==1) %>% #incongruent trials with correct response
  mutate(mean_rt = mean(rt),
         sd_rt = sd(rt)) %>% # compute individual mean and sd RT
  filter(rt>=0.1 & rt>(mean_rt - 3*sd_rt) & rt<(mean_rt + 3*sd_rt)) %>% #remove trials less than 100ms and less than 3SD below or 2SD above the mean RT
  summarise(med_rt = median(rt)*1000) %>% # compute individual level median RT
  mutate(rt_score = 5-(5*((log(med_rt)-log(250))/(log(1000)-log(250)))))
LDDM_second',s,'_3 <-  LDDM_second',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  filter(stim=="incongruent" & response==1) %>% #incongruent trials with correct response
  mutate(mean_rt = mean(rt),
         sd_rt = sd(rt)) %>% # compute individual mean and sd RT
  filter(rt>=0.1 & rt>(mean_rt - 3*sd_rt) & rt<(mean_rt + 3*sd_rt)) %>% #remove trials less than 100ms and less than 3SD below or 2SD above the mean RT
  summarise(med_rt = median(rt)*1000) %>% # compute individual level median RT
  mutate(rt_score = 5-(5*((log(med_rt)-log(250))/(log(1000)-log(250)))))

LDDM_first',s,' <- LDDM_first',s,'_1 %>%
  full_join(LDDM_first',s,'_2, by = "subj_idx") %>%
  full_join(LDDM_first',s,'_3, by="subj_idx") %>%
  group_by(subj_idx) %>% # per subject
  mutate(total_accuracy_perc = sum(response==1)/length(response)) %>% # compute total accuracy percentage
  summarise(flanker_score_list_d2 = if_else(total_accuracy_perc>=0.8, accuracy_score+rt_score, accuracy_score),
            accuracy = mean(total_accuracy_perc)) %>%# if accuracy is above 80% then add accuracy and rt flanker scores, if not base the flanker score only on accuracy
  transmute(ID=subj_idx, flanker_score_list_d2=flanker_score_list_d2, accuracy=accuracy) %>%
  group_by(ID) %>% # per subject
  summarise(flanker_score_d2 = mean(flanker_score_list_d2),
            accuracy = mean(accuracy))
LDDM_second',s,' <- LDDM_second',s,'_1 %>%
  full_join(LDDM_second',s,'_2, by = "subj_idx") %>%
  full_join(LDDM_second',s,'_3, by="subj_idx") %>%
  group_by(subj_idx) %>% # per subject
  mutate(total_accuracy_perc = sum(response==1)/length(response)) %>% # compute total accuracy percentage
  summarise(flanker_score_list_d2 = if_else(total_accuracy_perc>=0.8, accuracy_score+rt_score, accuracy_score),
            accuracy = mean(total_accuracy_perc)) %>%# if accuracy is above 80% then add accuracy and rt flanker scores, if not base the flanker score only on accuracy
  transmute(ID=subj_idx, flanker_score_list_d2=flanker_score_list_d2, accuracy=accuracy) %>%
  group_by(ID) %>% # per subject
  summarise(flanker_score_d2 = mean(flanker_score_list_d2),
            accuracy = mean(accuracy))
            
r_half_',s,' <- cor(LDDM_first',s,'$flanker_score_d2, LDDM_second',s,'$flanker_score_d2, use="pairwise")
r_half_ci_',s,' <- ci_cor(LDDM_first',s,'$flanker_score_d2, LDDM_second',s,'$flanker_score_d2, use="pairwise")
r_sb_ci_lower_',s,' <- (2*r_half_ci_',s,'$interval[1])/(1+r_half_ci_',s,'$interval[1])
r_sb_ci_upper_',s,' <- (2*r_half_ci_',s,'$interval[2])/(1+r_half_ci_',s,'$interval[2])
r_sb_',s,' <- (2*r_half_',s,')/(1+r_half_',s,')
')))
}

spearman_brown_d2 <- data.frame(trials=seq(15,165,15),
                             r=rep(NA,length(seq(15,165,15))),
                             r_ci_lower=rep(NA,length(seq(15,165,15))),
                             r_ci_upper=rep(NA,length(seq(15,165,15))))
i=1
for (s in seq(15,165,15)){
  eval(parse(text=paste0('spearman_brown_d2[i,2] <- round(as.numeric(r_sb_',s,'),3)
                         spearman_brown_d2[i,3] <- round(as.numeric(r_sb_ci_lower_',s,'),3)
                         spearman_brown_d2[i,4] <- round(as.numeric(r_sb_ci_upper_',s,'),3)')))
  i=i+1
}
spearman_brown_d2

ggplot(spearman_brown_d2, aes(x=trials, y=r, group=1)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(limits = c(0, 1)) +
  geom_ribbon(aes(ymin = r_ci_lower, ymax = r_ci_upper), alpha = 0.2)
```

#### Day 3
```{r}
# Calculate typical metrics
load(file=here("./data/LDDM_cleaning04_fullbeh_d3.RData"))

LDDM_cleaning04_d3_calc1 <- LDDM_cleaning04_fullbeh_d3 %>%
  group_by(subj_idx) %>%
  mutate(block = c(rep(1,30),rep(2,30),rep(3,30),rep(4,30),rep(5,30),rep(6,30),rep(7,30),rep(8,30),rep(9,30),rep(10,30),rep(11,30))) %>%
  group_by(subj_idx, block) %>%
  mutate(trial = 1:30)

LDDM_cleaning04_d3_reliability <- LDDM_cleaning04_fullbeh_d3 %>%
  group_by(subj_idx) %>%
  mutate(block = c(rep(1,30),rep(2,30),rep(3,30),rep(4,30),rep(5,30),rep(6,30),rep(7,30),rep(8,30),rep(9,30),rep(10,30),rep(11,30))) %>%
  group_by(subj_idx) %>%
  mutate(trial = 1:330)

for (s in seq(15,166,15)){
    eval(parse(text=paste0('
LDDM_first',s,'_1 <- LDDM_cleaning04_d3_reliability %>% filter(trial<=',s,')
LDDM_second',s,'_1 <- LDDM_cleaning04_d3_reliability %>% filter(trial< ',(s*2)+1,' & trial>',s,')
  
LDDM_first',s,'_2 <- LDDM_first',s,'_1 %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))
LDDM_second',s,'_2 <- LDDM_second',s,'_1 %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))

LDDM_first',s,'_3 <-  LDDM_first',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  filter(stim=="incongruent" & response==1) %>% #incongruent trials with correct response
  mutate(mean_rt = mean(rt),
         sd_rt = sd(rt)) %>% # compute individual mean and sd RT
  filter(rt>=0.1 & rt>(mean_rt - 3*sd_rt) & rt<(mean_rt + 3*sd_rt)) %>% #remove trials less than 100ms and less than 3SD below or 2SD above the mean RT
  summarise(med_rt = median(rt)*1000) %>% # compute individual level median RT
  mutate(rt_score = 5-(5*((log(med_rt)-log(250))/(log(1000)-log(250)))))
LDDM_second',s,'_3 <-  LDDM_second',s,'_1 %>%
  group_by(subj_idx) %>% # per subject
  filter(stim=="incongruent" & response==1) %>% #incongruent trials with correct response
  mutate(mean_rt = mean(rt),
         sd_rt = sd(rt)) %>% # compute individual mean and sd RT
  filter(rt>=0.1 & rt>(mean_rt - 3*sd_rt) & rt<(mean_rt + 3*sd_rt)) %>% #remove trials less than 100ms and less than 3SD below or 2SD above the mean RT
  summarise(med_rt = median(rt)*1000) %>% # compute individual level median RT
  mutate(rt_score = 5-(5*((log(med_rt)-log(250))/(log(1000)-log(250)))))

LDDM_first',s,' <- LDDM_first',s,'_1 %>%
  full_join(LDDM_first',s,'_2, by = "subj_idx") %>%
  full_join(LDDM_first',s,'_3, by="subj_idx") %>%
  group_by(subj_idx) %>% # per subject
  mutate(total_accuracy_perc = sum(response==1)/length(response)) %>% # compute total accuracy percentage
  summarise(flanker_score_list_d3 = if_else(total_accuracy_perc>=0.8, accuracy_score+rt_score, accuracy_score),
            accuracy = mean(total_accuracy_perc)) %>%# if accuracy is above 80% then add accuracy and rt flanker scores, if not base the flanker score only on accuracy
  transmute(ID=subj_idx, flanker_score_list_d3=flanker_score_list_d3, accuracy=accuracy) %>%
  group_by(ID) %>% # per subject
  summarise(flanker_score_d3 = mean(flanker_score_list_d3),
            accuracy = mean(accuracy))
LDDM_second',s,' <- LDDM_second',s,'_1 %>%
  full_join(LDDM_second',s,'_2, by = "subj_idx") %>%
  full_join(LDDM_second',s,'_3, by="subj_idx") %>%
  group_by(subj_idx) %>% # per subject
  mutate(total_accuracy_perc = sum(response==1)/length(response)) %>% # compute total accuracy percentage
  summarise(flanker_score_list_d3 = if_else(total_accuracy_perc>=0.8, accuracy_score+rt_score, accuracy_score),
            accuracy = mean(total_accuracy_perc)) %>%# if accuracy is above 80% then add accuracy and rt flanker scores, if not base the flanker score only on accuracy
  transmute(ID=subj_idx, flanker_score_list_d3=flanker_score_list_d3, accuracy=accuracy) %>%
  group_by(ID) %>% # per subject
  summarise(flanker_score_d3 = mean(flanker_score_list_d3),
            accuracy = mean(accuracy))
            
r_half_',s,' <- cor(LDDM_first',s,'$flanker_score_d3, LDDM_second',s,'$flanker_score_d3, use="pairwise")
r_half_ci_',s,' <- ci_cor(LDDM_first',s,'$flanker_score_d3, LDDM_second',s,'$flanker_score_d3, use="pairwise")
r_sb_ci_lower_',s,' <- (2*r_half_ci_',s,'$interval[1])/(1+r_half_ci_',s,'$interval[1])
r_sb_ci_upper_',s,' <- (2*r_half_ci_',s,'$interval[2])/(1+r_half_ci_',s,'$interval[2])
r_sb_',s,' <- (2*r_half_',s,')/(1+r_half_',s,')
')))
}

spearman_brown_d3 <- data.frame(trials=seq(15,165,15),
                             r=rep(NA,length(seq(15,165,15))),
                             r_ci_lower=rep(NA,length(seq(15,165,15))),
                             r_ci_upper=rep(NA,length(seq(15,165,15))))
i=1
for (s in seq(15,165,15)){
  eval(parse(text=paste0('spearman_brown_d3[i,2] <- round(as.numeric(r_sb_',s,'),3)
                         spearman_brown_d3[i,3] <- round(as.numeric(r_sb_ci_lower_',s,'),3)
                         spearman_brown_d3[i,4] <- round(as.numeric(r_sb_ci_upper_',s,'),3)')))
  i=i+1
}
spearman_brown_d3

ggplot(spearman_brown_d3, aes(x=trials, y=r, group=1)) +
  geom_line() +
  geom_point() +
  scale_y_continuous(limits = c(0, 1)) +
  geom_ribbon(aes(ymin = r_ci_lower, ymax = r_ci_upper), alpha = 0.2)
```


# 5. Accuracy
## 5.1 First vs second half of task
```{r}
LDDM_accuracy_d1_1 <- LDDM_cleaning04_d1_calc1 %>%
  filter(block<6) %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))

LDDM_accuracy_d1_2 <- LDDM_cleaning04_d1_calc1 %>%
  filter(block>=6) %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))

t.test(LDDM_accuracy_d1_1$accuracy_score, LDDM_accuracy_d1_2$accuracy_score)

LDDM_accuracy_d2_1 <- LDDM_cleaning04_d2_calc1 %>%
  filter(block<6) %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))

LDDM_accuracy_d2_2 <- LDDM_cleaning04_d2_calc1 %>%
  filter(block>=6) %>%
  group_by(subj_idx) %>%
  summarise(accuracy_score = sum(response==1)*(5/length(trial)))

t.test(LDDM_accuracy_d2_1$accuracy_score, LDDM_accuracy_d2_2$accuracy_score)
```
Participants are not significantly more accurate in the first 5 than second 6 blocks of the task on both Day 1 and Day 2.

# 6. Compared to RT and accuracy alone
## Day 1
```{r eval=F}
### Day 1

# ERN
mr_ERN_table_d1_rt_acc <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[2]),
                      p_ddm=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[2],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[2]),
                      b_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + accuracy, LDDM_do2_d1))$estimate[3]),
                      p_flanker=c(tidy(lm(FCZ_ERN_080_z ~ v_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_congruent_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ v_incongruent_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ a_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ t_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[3],
                       tidy(lm(FCZ_ERN_080_z ~ z_S1_B11_z + accuracy, LDDM_do2_d1))$p.value[3]))
write.csv(mr_ERN_table_d1, here("./tables/mr_ERN_table_d1.csv"))

# P3
mr_P3_table_d1 <- data.frame(Parameters=c("v","v_congruent","v_incongruent","a","t","z"),
                      b_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[2]),
                      p_ddm=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[2]),
                      b_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$estimate[3]),
                      p_flanker=c(tidy(lm(PZ_P3_onset_incon_z ~ v_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_congruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ v_incongruent_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ a_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ t_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3],
                       tidy(lm(PZ_P3_onset_incon_z ~ z_S1_B11_z + flanker_score_d1_z, LDDM_do2_d1))$p.value[3]))
write.csv(mr_P3_table_d1, here("./tables/mr_P3_table_d1.csv"))

corr.test(LDDM_do2_d1$flanker_score_d1, LDDM_do2_d1$PZ_P3_onset_incon_z, use="complete.obs", method="pearson")
```
```


# 6. Closing out
  In this step, go ahead and close out of the file and quit R without saving
  the work space.
```{r}
   # renv::snapshot()   #Take a snapshot of environment
```

